cov_calc computes satellite IR observation covariances based on Desroziers' method. It will compute interchannel correlations, if they exist. 

See
Desroziers, Gérald, et al. "Diagnosis of observation, background and analysis‐error statistics in observation space." Quarterly Journal of the Royal Meteorological Society 131.613 (2005): 3385-3396. 

This program uses the radstat.gdas.$date files, and outputs up to four binary files.  The first binary file contains the covariance matrix (plus extra information about the matrix), which can readily be used in the GSI. Outputting the other files is optional. They contain the wavenumbers of the satellite instrument, the assumed obs error, and the correlation matrix.

To use the computed covariance matrix in the GSI:
1.  Add a table to the anavinfo file, following the comments in src/correlated_obsmod.F90.  Note that 'global' use as defined in these comments actually only uses the diagonal of the computed covariance matrix, not the full matrix.
2.  Copy the covariance matrix into the data directory.  For parallel GFS, this can be achieved by adding a line such as 'cp $ROTDIR/Rcov* $DATA' to exglobal_analysis.sh.ecf.  For single runs of the GSI, add this line to rungsi_globalprod.sh.

Before running this program, compile it by typing 'make'.

There are two ways to run cov_calc.  The bottleneck of this program is in dealing with the radstat files.  Using parallel_run.sh will process the radstat files in parallel.  To use this script, edit its first few lines, and then simply run it. 

If the amount of radstat files is small, or they have already been processed (see below), then run.sh can be used.  Edit its first few lines and either run it or submit submit_job.sh as a job. If using submit_job.sh, it may be necessary to change the number of processors to run cov_calc on; the number of procs must not be greater than the number of radstat files.

cov_calc requires the files diag_$instr_anl.$date and diag and diag_$instr_ges.$date from the radstat files.  The first analysis diag file must be renamed danl_0001, the second renamed danl_0002, etc, while the first background file must be renamed dges_0001 and so on.  Even if a diag file is missing, the danl and dges files count up by one each time.  The scripts parallel_run.sh and run.sh process the radstat files in this manner.  
